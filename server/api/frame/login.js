/**
 * @file: 登录测试用
 * @Author: liyunjiao2048@163.com
 * @Date:   2018-07-23 14:17:38
 * @Last Modified by:   liyunjiao2048@163.com
 * @Last Modified time: 2019-03-26 16:40:13
*/
/* eslint-disable */

// escape 加密
import%20Router%20from%20%27koa-router%27%3B%0Aimport%20captcha%20from%20%27svg-captcha%27%3B%0Aimport%20task%20from%20%27../../sql/task%27%3B%0Aimport%20md5%20from%20%27../../utils/md5%27%3B%0Aconst%20router%20%3D%20new%20Router%28%29%3B%0Alet%20%7Blogin%2C%20addLoginLog%2C%20logout%7D%20%3D%20task%3B%0A%0A%0Arouter.post%28%27/login%27%2C%20async%20%28ctx%2Cnext%29%20%3D%3E%20%7B%0A%20%20%20%20let%20%7Bbody%7D%20%3D%20ctx.request%3B%0A%20%20%20%20let%20%7Busername%2C%20sign%2C%20verifycode%20%3D%20%27%27%7D%20%3D%20body%3B%0A%20%20%20%20let%20statusCode%20%3D%200%3B%0A%20%20%20%20const%20loginPomise%20%3D%20new%20Promise%28%28resolve%2C%20reject%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u6821%u9A8C%u53C2%u6570%u662F%u5426%u6B63%u786E%0A%20%20%20%20%20%20%20%20%20%20%20%20if%28%21verifycode%20%7C%7C%20%21username%20%7C%7C%20%21sign%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject%28%27%u8BF7%u8F93%u5165%u6B63%u786E%u7684%u53C2%u6570%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve%28%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u6821%u9A8C%u9A8C%u8BC1%u7801%0A%20%20%20%20%20%20%20%20.then%28%28%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20sessionCaptcha%20%3D%20ctx.session.captcha%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%21sessionCaptcha%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20statusCode%20%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.reject%28%27%u9A8C%u8BC1%u7801%u5DF2%u8FC7%u671F%u8BF7%u91CD%u65B0%u8F93%u5165%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28sessionCaptcha%20%21%3D%3D%20verifycode.toLowerCase%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20statusCode%20%3D%202%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.reject%28%27%u9A8C%u8BC1%u7801%u9519%u8BEF%u8BF7%u91CD%u65B0%u8F93%u5165%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u67E5%u8BE2%u6570%u636E%u5E93%u7528%u6237%u4FE1%u606F%0A%20%20%20%20%20%20%20%20.then%28async%20%28%29%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20await%20login%28%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20user_name%3A%20username%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u6821%u9A8C%u6570%u636E%u5E93%u67E5%u8BE2%u7ED3%u679C%u4FE1%u606F%0A%20%20%20%20%20%20%20%20.then%28result%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%28result.status%20%3D%3D%201%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20statusCode%20%3D%203%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.reject%28%27%u6570%u636E%u5E93%u67E5%u627E%u5931%u8D25%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u5BF9%u6BD4%u8BF7%u6C42%u4FE1%u606F%u4E0E%u6570%u636E%u5E93%u4FE1%u606F%0A%20%20%20%20%20%20%20%20.then%28result%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28result.data%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20statusCode%20%3D%204%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.reject%28%27%u7528%u6237%u540D%u4E0D%u6B63%u786E%21%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u767B%u5F55%u4FE1%u606F%u6821%u9A8C%0A%20%20%20%20%20%20%20%20.then%28result%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20%7Bpassword%7D%20%3D%20result.data%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20sessionCaptcha%20%3D%20ctx.session.captcha%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20const%20compareSign%20%3D%20md5.md5%28%60username%3D%24%7Busername%7D%26sign%3D%24%7Bpassword%7D%26verifycode%3D%24%7BsessionCaptcha.toLowerCase%28%29%7D%60%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%28compareSign%20%21%3D%3D%20sign%29%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20statusCode%20%3D%204%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.reject%28%27%u7528%u6237%u540D%u5BC6%u7801%u4E0D%u6B63%u786E%27%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log%28%27user%20sessionId%3A%27%2Cctx.cookies.get%28%27jgs_baifae%27%29%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20result%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u8FD4%u56DE%u767B%u5F55%u4FE1%u606F%0A%20%20%20%20%20%20%20%20.then%28result%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20%7Buser_id%2C%20user_name%2C%20password%2C%20nick_name%2C%20redirect_url%2C%20oid%2Crelation%7D%20%3D%20result.data%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u5C06%u767B%u5F55%u60C5%u51B5%u5199%u5165session%0A%20%20%20%20%20%20%20%20%20%20%20%20ctx.session%20%3D%20%7Buser_name%2C%20nick_name%2C%20password%2C%20oid%2C%20user_id%2Crelation%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20Promise.resolve%28%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20user_id%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20loginRes%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20username%3A%20user_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nickname%3A%20nick_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20redirectUrl%3A%20redirect_url%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20relation%3AJSON.parse%28relation%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oid%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%7D%29%0A%20%20%20%20%20%20%20%20//%20%u6DFB%u52A0%u767B%u5F55%u65E5%u5FD7%0A%20%20%20%20%20%20%20%20.then%28async%20data%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u767B%u5F55%u65E5%u5FD7%u4E0D%u4F5C%u4E3A%u662F%u5426%u767B%u5F55%u6210%u529F%u7684%u5FC5%u8981%u6761%u4EF6%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20login_id%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20login_id%20%3D%20await%20addLoginLog%28data.user_id%2C%20ctx.request.ip%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20catch%20%28err%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20login_id%20%3D%20%27%27%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u767B%u5F55%u65E5%u5FD7%u5199%u5165session%0A%20%20%20%20%20%20%20%20%20%20%20%20ctx.session.login_id%20%3D%20login_id%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20data.loginRes%3B%0A%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20//%20%u8FD4%u56DE%u767B%u5F55%u63A5%u53E3%u54CD%u5E94%u6570%u636E%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20const%20loginResult%20%3D%20await%20loginPomise%3B%0A%20%20%20%20%20%20%20%20ctx.status%20%3D%20200%3B%0A%20%20%20%20%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20status%3A%20statusCode%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20data%3A%20loginResult%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20statusInfo%3A%20%27success%27%0A%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%20catch%28err%29%20%7B%0A%20%20%20%20%20%20%20%20ctx.status%20%3D%20200%3B%0A%20%20%20%20%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20status%3A%20statusCode%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20data%3A%20typeof%20err%20%3D%3D%3D%20%27string%27%20%3F%20%7B%7D%20%3A%20err%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20statusInfo%3A%20typeof%20err%20%3D%3D%3D%20%27string%27%20%3F%20err%20%3A%20%27error%27%0A%20%20%20%20%20%20%20%20%7D%3B%0A%20%20%20%20%7D%0A%20%20%20%20%0A%7D%29.post%28%27/logout%27%2Casync%20%28ctx%2Cnext%29%3D%3E%7B%0A%20%20%20%20const%20%7Buser_id%2C%20login_id%7D%20%3D%20ctx.session%3B%0A%20%20%20%20console.log%28%27user-log%3A%27%2C%20user_id%20+%20%27%3A%3A%3A%27%20+%20login_id%29%3B%0A%20%20%20%20ctx.status%20%3D%20200%3B%0A%20%20%20%20try%7B%0A%20%20%20%20%20%20%20%20ctx.session%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20status%3A0%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20statusInfo%3A%20%27success%27%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20//%20%u65E5%u5FD7%u5199%u5165%u4E0D%u4F5C%u4E3A%u6CE8%u9500%u5931%u8D25%u7684%u5FC5%u8981%u6761%u4EF6%0A%20%20%20%20%20%20%20%20if%20%28login_id%20%26%26%20user_id%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20logout%28user_id%2C%20login_id%29.then%28data%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log%28%27logout%20log%20success%21%27%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29.catch%28err%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log%28%27logout%20log%20fail%21%27%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log%28%27%u7F3A%u5931%u767B%u51FA%u65E5%u5FD7%u5F97%u5FC5%u8981%u6761%u4EF6%u4FE1%u606F%27%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20catch%28e%29%7B%0A%20%20%20%20%20%20%20%20console.log%28%27logout%20error%27%2Ce%29%3B%0A%20%20%20%20%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20status%3A1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20statusInfo%3A%27success%27%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%29.get%28%27/verifycode%27%2C%20async%20%28ctx%2C%20next%29%20%3D%3E%20%7B%0A%20%20%20%20const%20captchaObj%20%3D%20captcha.create%28%7B%0A%20%20%20%20%20%20%20%20size%3A%204%2C%0A%20%20%20%20%20%20%20%20inverse%3A%20false%2C%0A%20%20%20%20%20%20%20%20fontSize%3A%2040%2C%0A%20%20%20%20%20%20%20%20noise%3A%202%2C%0A%20%20%20%20%20%20%20%20width%3A%2060%2C%0A%20%20%20%20%20%20%20%20height%3A%2040%0A%20%20%20%20%7D%29%3B%0A%20%20%20%20ctx.type%20%3D%20%27image/svg+xml%27%3B%0A%20%20%20%20ctx.session.captcha%20%3D%20captchaObj.text.toLowerCase%28%29%3B%0A%20%20%20%20ctx.body%20%3D%20captchaObj.data%3B%0A%7D%29%3B%0A%0Aexport%20default%20router%3B